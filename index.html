<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Arquétipo das Deusas</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Qual é o Padrão Oculto que Sabota seus Relacionamentos?</h1>

    <div id="intro-container">
        <h2>Vamos descobrir juntas o seu padrão de amar.</h2>

        <p>Vamos descobrir juntas o seu padrão de amar e analisar os sinais que revelam como você se relaciona.</p>

        <p>Este é um teste gratuito, baseado nos arquétipos das Deusas Gregas, desenvolvidos pela psiquiatra junguiana Jean Shinoda Bolen, que refletem diferentes formas de amar e se relacionar.</p>

        <p style="text-align: center; font-weight: bold;">Responda apenas 7 perguntas rápidas e precisas.</p>

        <div class="intro-warning-box">
            <h3>⚠ No final, você receberá:</h3>
            <ul>
                <li>Sua Deusa Principal, que revela como você ama.</li>
                <li>A Sombra que bloqueia seus relacionamentos.</li>
                <li>Um mapa claro do seu padrão de amor, pronto para começar a transformação.</li>
            </ul>
        </div>

        <p class="intro-tip">‼ Dica importante: responda com atenção e honestidade, refletindo sobre cada pergunta. Só você terá acesso às suas respostas.</p>
        
        <button id="start-button">Iniciar Teste Agora</button>
    </div>

    <div id="quiz-container" style="display:none;">
        <p id="loading-msg">Carregando o teste...</p>
    </div>
    
    <div id="resultado-container" style="display:none;">
        <h2>Seu Resultado:</h2>
        <h3 id="resultado-titulo"></h3>
        
        <div class="resultado-art-wrapper">
            <img id="resultado-imagem" src="" alt="Arte do Arquétipo" onerror="this.style.display='none'">
        </div>

        <p id="resultado-texto"></p>
        
        <a href="https://raissagara.hotmart.host/nova-pagina-5898d9d8-7196-45f5-baef-ae4834adfb3e" class="cta-button" target="_blank">
            ✨ Me identifiquei quero saber mais ✨
        </a>

        <button onclick="location.reload()" style="margin-top: 30px; opacity: 0.7; font-size: 0.9rem;">
            Refazer Teste
        </button>
    </div>

<script>
    // --- Variáveis Globais ---
    let perguntas = [];
    let textos = {};
    
    // Elementos do fluxo
    const introContainer = document.getElementById('intro-container');
    const startButton = document.getElementById('start-button');
    const quizContainer = document.getElementById('quiz-container');
    const resultadoContainer = document.getElementById('resultado-container');
    
    let perguntaAtual = 0;
    let respostasUsuario = [];

    // --- MAPA DE DEUSAS ---
    const mapaDeusas = {
        'A': 'Afrodite', 'B': 'Atena', 'C': 'Deméter',
        'D': 'Ártemis', 'E': 'Perséfone', 'F': 'Hera', 'G': 'Héstia'
    };

    // --- FLUXO PRINCIPAL ---

    // 1. Adiciona o listener para o botão de iniciar
    startButton.addEventListener('click', startTest);

    function startTest() {
        introContainer.style.display = 'none'; // Esconde a introdução
        quizContainer.style.display = 'block'; // Mostra o container de carregamento do quiz
        iniciarQuiz(); // Inicia o carregamento dos dados e do quiz
    }

    // 2. Lógica para carregar os dados JSON (continua a mesma)
    async function iniciarQuiz() {
        try {
            const [resPerguntas, resTextos] = await Promise.all([
                fetch('perguntas.json'),
                fetch('textos.json')
            ]);

            if (!resPerguntas.ok || !resTextos.ok) {
                throw new Error('Falha ao carregar arquivos .json.');
            }

            perguntas = await resPerguntas.json();
            textos = await resTextos.json();

            if (perguntas.length > 0) {
                carregarPergunta();
            } else {
                quizContainer.innerHTML = "<p>Erro: O arquivo de perguntas está vazio.</p>";
            }

        } catch (error) {
            console.error("Erro ao carregar quiz:", error);
            quizContainer.innerHTML = "<p>Erro ao carregar o teste. Verifique se os arquivos 'perguntas.json' e 'textos.json' estão na pasta correta.</p>";
        }
    }
    
    // 3. Lógica para carregar as perguntas
    function carregarPergunta() {
        if (perguntaAtual >= perguntas.length) {
            mostrarResultados();
            return;
        }

        const p = perguntas[perguntaAtual];
        let htmlRespostas = '';
        
        for (const letra in p.respostas) {
            htmlRespostas += `<button class="resposta" data-letra="${letra}">
                                <strong>${letra}:</strong> ${p.respostas[letra]}
                              </button>`;
        }

        quizContainer.innerHTML = `
            <h2>${p.pergunta}</h2>
            <p style="text-align:center; color: #888; font-size: 0.9rem; margin-bottom: 20px;">
                Pergunta ${perguntaAtual + 1} de ${perguntas.length}
            </p>
            ${htmlRespostas}
        `;

        document.querySelectorAll('.resposta').forEach(button => {
            button.addEventListener('click', () => {
                respostasUsuario.push(button.dataset.letra);
                perguntaAtual++;
                carregarPergunta();
            });
        });
    }

    // 4. Lógica de cálculo e exibição de resultados
    function mostrarResultados() {
        quizContainer.innerHTML = "<h2>Calculando seu resultado...</h2>";

        try {
            const contagemLetras = respostasUsuario.reduce((acc, letra) => {
                acc[letra] = (acc[letra] || 0) + 1;
                return acc;
            }, {});

            const contagemDeusas = {};
            for (const letra in contagemLetras) {
                if (mapaDeusas[letra]) {
                    const nomeDeusa = mapaDeusas[letra];
                    contagemDeusas[nomeDeusa] = contagemLetras[letra];
                }
            }

            const deusasOrdenadas = Object.entries(contagemDeusas).sort(([, countA], [, countB]) => countB - countA);
            
            if (deusasOrdenadas.length === 0) throw new Error("Sem respostas válidas.");

            const dominante = deusasOrdenadas[0][0];
            const secundaria = deusasOrdenadas[1] ? deusasOrdenadas[1][0] : "Pura";

            let textoResultado = "Erro: Combinação de texto não encontrada.";
            if (textos[dominante] && textos[dominante][secundaria]) {
                textoResultado = textos[dominante][secundaria];
            }
            
            const imgElement = document.getElementById('resultado-imagem');
            const domLimpo = removerAcentos(dominante);
            const secLimpo = removerAcentos(secundaria);
            
            imgElement.src = `img/${domLimpo}_${secLimpo}.jpg`;
            imgElement.style.display = 'block';

            document.getElementById('resultado-titulo').innerHTML = `Dominante: ${dominante} / Sombra: ${secundaria}`;
            document.getElementById('resultado-texto').innerHTML = textoResultado;
            
            quizContainer.style.display = 'none';
            resultadoContainer.style.display = 'block';
            window.scrollTo(0, 0);

        } catch (error) {
            console.error("Erro:", error);
            quizContainer.innerHTML = "Ocorreu um erro ao calcular o resultado. Tente atualizar a página.";
        }
    }

    // Função auxiliar para remover acentos (para nomear arquivos)
    function removerAcentos(texto) {
        return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

</script>
</body>
</html>